<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SemanticGAN</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>

    <header class="header">
      <h1>SemanticGAN</h1>

      <div class="intro">
        A research prototype that generates RDF triples from the
        <a href="https://dblp.org/xml/" target="_blank" style="color: var(--accent); text-decoration: none; border-bottom: 1px dotted;">
          DBLP Computer Science Bibliography
        </a>
        using a
        <a href="https://fr.wikipedia.org/wiki/R%C3%A9seaux_antagonistes_g%C3%A9n%C3%A9ratifs_de_Wasserstein" target="_blank" style="color: var(--accent); text-decoration: none; border-bottom: 1px dotted;">
          Wasserstein GAN
        </a>
      </div>

      <div class="last-updated" id="lastUpdated">Loading system status...</div>
    </header>

    <main id="main">

      <div class="section">
        <h2>Model Metrics</h2>
        <p class="note-description">
          Metrics computed from the most recent training run
        </p>

        <div class="metrics-grid">
          <div class="metric-card">
            <div class="metric-val" id="noveltyScore">--%</div>
            <div class="metric-label">Novelty Score</div>
            <div class="metric-sub">Not present in training data</div>
          </div>

          <div class="metric-card">
            <div class="metric-val" id="uniqueScore">--%</div>
            <div class="metric-label">Uniqueness Score</div>
            <div class="metric-sub">Distinct generated triples</div>
          </div>

          <div class="metric-card">
            <div class="metric-val" id="overlapScore">--%</div>
            <div class="metric-label">Train Overlap</div>
            <div class="metric-sub">Exact matches with training triples</div>
          </div>

          <div class="metric-card">
            <div class="metric-val" id="relDiversity">--%</div>
            <div class="metric-label">Relation Diversity</div>
            <div class="metric-sub">Used relation types vs schema</div>
          </div>

          <div class="metric-card">
            <div class="metric-val" id="schemaValidity">--%</div>
            <div class="metric-label">Schema Validity</div>
            <div class="metric-sub">Valid under the schema</div>
          </div>

          <div class="metric-card">
            <div class="metric-val" id="totalGen">--</div>
            <div class="metric-label">Generated RDF Candidates</div>
            <div class="metric-sub">Produced in the latest run</div>
          </div>
        </div>
      </div>

      <div class="section">
        <h2>Relation Distribution</h2>
        <p class="note-description">
          Distribution of generated triples across relation types
        </p>
        <p class="note-description" style="font-size: 0.85em; color: var(--text-secondary);">
          Average embedding distance: <span id="avgDistance">--</span>
        </p>
        <div id="relationBars" class="relation-bars"></div>
      </div>

      <div class="section">
        <h2>Generated RDF Candidates</h2>
        <p class="note-description">
          The following triples were generated by the model
          <span class="novel-tag">NOVEL</span> indicates a connection not present in the original training data
        </p>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th style="width: 25%">Relation</th>
                <th style="width: 50%">Generated Entity</th>
                <th style="width: 15%">Score</th>
                <th style="width: 10%">Type</th>
              </tr>
            </thead>
            <tbody id="hypothesesTable">
              <tr>
                <td colspan="4" style="text-align:center; padding: 20px;">
                  Loading model outputs...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="section">
        <h2>Training Loss</h2>
        <p class="note-description">
          Training loss progression over daily updates
        </p>
        <div class="chart-container">
          <img
            src="data/processed/loss_curve.png"
            alt="Training loss curve"
            onerror="this.style.display='none'; this.parentElement.innerHTML='<p style=&quot;color:#999&quot;>Chart pending next training run.</p>'"
          >
        </div>
      </div>

    </main>

    <script>
      async function loadDashboard() {
        try {
          const response = await fetch('dashboard_data.json', { cache: "no-store" });
          if (!response.ok) throw new Error("Dashboard data not found");

          const data = await response.json();

          document.getElementById('lastUpdated').innerText =
            "System Status: ONLINE | Last Run: " + data.last_updated;

          document.getElementById('noveltyScore').innerText = data.stats.novelty + "%";
          document.getElementById('uniqueScore').innerText = data.stats.uniqueness + "%";
          document.getElementById('overlapScore').innerText = data.stats.train_overlap + "%";
          document.getElementById('relDiversity').innerText = data.stats.relation_diversity + "%";
          document.getElementById('schemaValidity').innerText = data.stats.schema_validity + "%";
          document.getElementById('totalGen').innerText = data.stats.total_generated;
          document.getElementById('avgDistance').innerText = data.stats.avg_distance;

          const tbody = document.getElementById('hypothesesTable');
          tbody.innerHTML = "";

          data.hypotheses.forEach(h => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${h.relation}</td>
              <td>${h.entity}</td>
              <td style="font-family: monospace;">${h.score}</td>
              <td>${h.novel ? '<span class="novel-tag">NOVEL</span>' : 'EXISTING'}</td>
            `;
            tbody.appendChild(tr);
          });

          const bars = document.getElementById("relationBars");
          bars.innerHTML = "";
          data.relation_freq.forEach(rf => {
            const wrap = document.createElement("div");
            wrap.className = "rel-wrap";
            wrap.innerHTML = `
              <div class="rel-label">${rf.relation} (${rf.percent}%)</div>
              <div class="rel-bar"><div class="rel-fill" style="width:${rf.percent}%"></div></div>
            `;
            bars.appendChild(wrap);
          });

        } catch (err) {
          document.getElementById('lastUpdated').innerText =
            "System Status: OFFLINE (Data missing)";
        }
      }

      document.addEventListener("DOMContentLoaded", loadDashboard);
    </script>

    <style>
      .relation-bars { display: grid; row-gap: 10px; }
      .rel-label { font-size: 0.9rem; color: var(--text-secondary); }
      .rel-bar { background: rgba(255,255,255,0.06); height: 10px; border-radius: 4px; }
      .rel-fill { height: 10px; background: linear-gradient(90deg, var(--accent), #7ad7f0); }
    </style>

  </body>
</html>
